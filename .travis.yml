# Travis CI Configuration file
# @link https://travis-ci.org/

# Using Python for the project
language: python
python:
  # Python 2.6 is obsolete
  #- "2.6"
  # Python 2.7 is set to test the docs in the configuration matrix
  #- "2.7"
  # Python 3.2 is obsolete
  #- "3.2"
  - "3.3"
  - "3.4"
  # Python 3.5 is set to test and deploy the docs, and to run the coverage report, in the configuration matrix
  #- "3.5"
  - "pypy"
  - "pypy3"
matrix:
  include:
    # Tests docs
    - python: "2.7"
      env: TEST_DOCS=true
    # Tests and deploys docs, also runs coverage report
    - python: "3.5"
      env: COVERAGE=true TEST_DOCS=true DEPLOY_DOCS=true
addons:
  apt:
    packages:
    - sshpass

before_install:
  # Gets scripts
  - git clone -b v0.4.1 --single-branch https://github.com/Bernardo-MG/ci-shell-scripts.git ~/.scripts
  # Sets scripts as executable
  - chmod -R +x ~/.scripts/*
  # Prepares CI environment
  - source ~/.scripts/travis/load-travis-environment.sh
  - source ~/.scripts/travis/load-travis-environment-python.sh
install:
  # tox is required for the tests
  - pip install tox
  # sphinx is required for the docs
  - pip install sphinx
  # Dependencies
  - pip install --upgrade -r requirements.txt
script:
  # Code is checked
  - ~/.scripts/python/run_tests.sh true check
  # Tests are run
  - ~/.scripts/python/run_tests.sh true $PYTHON_VERSION_TEST
  # Documentation tests are run
  - ~/.scripts/python/run_tests.sh $DO_TEST_DOCS docs
  # Documentation tests are run
  - ~/.scripts/python/run_tests.sh $DO_COVERAGE coverage
after_success:
  # Documentation deployment
  - ~/.scripts/sphinx/build-html.sh $DO_DEPLOY_DOCS docs
  - cd ~/sphinx/build/html
  - ~/.scripts/deploy/deploy-ssh.sh $DO_DEPLOY_DOCS_RELEASE $DEPLOY_USERNAME $DEPLOY_PASSWORD $DEPLOY_HOST $DEPLOY_PORT $DEPLOY_PATH_RELEASE
  - ~/.scripts/deploy/deploy-ssh.sh $DO_DEPLOY_DOCS_DEVELOP $DEPLOY_USERNAME $DEPLOY_PASSWORD $DEPLOY_HOST $DEPLOY_PORT $DEPLOY_PATH_DEVELOP